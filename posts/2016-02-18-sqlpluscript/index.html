<!doctype html>
<head>
    <meta charset="utf-8">
    <title>Jongwony</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <link rel="stylesheet" href="/blog/static/css/style.css">
    <link rel="stylesheet" href="/blog/static/css/custom.css">
</head>

<body class="box">

<nav class="nav-menu">
    <ul>
        <li><a href="/blog/">Home</a></li>
        <li><a href="/blog/about.html">About me</a></li>
        <li><a href="https://github.com/lastone9182/blog">Source</a></li>
    </ul>
</nav>

<div class="container">

  <div class="content" role="main">
    
<h1>SQL*Plus 콘솔 환경설정</h1>
<p>2016-02-18 00:00:00</p>
<p>Oracle 데이터베이스를 이용할 때 주로 SQL Developer를 많이 씁니다.</p>

<p>하지만 따로 설치해야 한다는 단점이 있으며 만약 다른 서버에 설치된 오라클을 다룰 때 해당 서버에 설치가 되지 않은 경우에는 콘솔 환경에서의 최후의 툴 SQL*Plus 만 남게 됩니다.</p>

<p>콘솔 환경에서의 SQL이란 적막하기 그지없습니다.</p>

<pre class="codehilite"><code>SQL&gt;</code></pre>

<p>SPOOL이라는 SQL*Plus 명령어는 이 명령을 내린 시점부터 콘솔에 쓰여진 모든 내용을 로그로 저장하는데</p>

<p>명령을 내리는 시각을 알 수 있게 프롬프트를 변경하는 방법이 있습니다.</p>

<pre class="codehilite"><code class="language-sql">SET TIME ON
SET SQLPROMPT &quot;_user&gt; &quot;</code></pre>

<p>이를 적용하면 다음과 같이 프롬프트가 변경됩니다.</p>

<pre class="codehilite"><code>11:24:32 HR&gt;</code></pre>

<p>SET 명령어로 변경할 수 있는 파라미터는 다음 명령어로 모두 보실 수 있습니다.</p>

<pre class="codehilite"><code>SHOW ALL</code></pre>

<p>주로 linesize(가로), pagesize(세로)를 자주 변경하게 됩니다.</p>

<p>하지만 매번 접속할 때마다 변경하기 힘들 경우가 있기 때문에 이 때 리눅스의 .bash_profile과 같이 환경변수 처럼 지정할 수 있는 <strong>glogin.sql</strong> 이라는 파일이 있습니다.</p>

<p>이 파일은 보통 $ORACLE_HOME/sqlplus/admin에 위치하며</p>

<p>SQL*Plus 스키마에 접속할 때 한번만 실행됩니다.</p>

<p>콘솔 환경의 설정을 어느정도 해봤지만 각 칼럼은 제어가 힘들 수도 있습니다.</p>

<p>다음과 같은 현상으로 나타날 수 있습니다.</p>

<p><img alt="before_script" src="/image/database/before_script.png" /></p>

<p>이런 경우를 해결하기 위해 간단히 <a href="/file/col_resize.sql">스크립트</a>를 만들어 보았습니다.</p>

<pre class="codehilite"><code class="language-sql">-- Query clean display
set pagesize 0
set feedback off

-- SPOOL concatenation string in temp file
spool result.sql

-- col department_id format a20
SELECT DISTINCT('col '||COLUMN_NAME||' format a'||DATA_LENGTH) &quot;--&quot;
FROM USER_TAB_COLUMNS
WHERE TABLE_NAME IN (SELECT TABLE_NAME FROM USER_TABLES)
AND DATA_TYPE LIKE 'VARCHAR2';

spool off

-- result.sql read/write access
!chmod -R 770 result.sql

-- append glogin.sql
!cat result.sql &gt;&gt; $ORACLE_HOME/sqlplus/admin/glogin.sql

-- remove temp file
!rm -rf result.sql

!echo $ORACLE_HOME/sqlplus/admin/glogin.sql is UPDATED.
!read -p &quot; Press the Enter key SQL PLUS will be terminated.&quot;
!echo -----------------------------------\
!echo -- Please reconnect with SQLPlus.--\
!echo -----------------------------------\

-- session exit
exit</code></pre>

<div class="def">

위 스크립트가 저장된 파일을 SQL*Plus가 처음 실행되는 경로로 복사합니다.<br><br>

!pwd로 확인 할 수 있습니다.<br><br>

sqlplus로 적용할 세션에 접속한 후
위 스크립트를 실행해 주면 됩니다.

</div>

<p>예를들어 위 스크립트를 col_resize.sql로 저장하여 HR 샘플 스키마에서 적용시켜 본다고 하면</p>

<p>col_resize.sql 파일을 /u01 디렉토리에 저장 후</p>

<pre class="codehilite"><code>sqlplus hr
11:24:32 HR&gt; @col_resize</code></pre>

<p>위 스크립트는 현재 <strong>세션 연결된</strong> 스키마 내에 있는 모든 테이블의 <strong>VARCHAR2</strong> 자료형을 가진 칼럼을 검색해서 그 칼럼이 제한한 길이만큼 사이즈를 조절하는 스크립트입니다.</p>

<p>예를들어 HR스키마에 접속했다면 HR내의 모든 테이블의 VARCHAR2 칼럼의 크기를 조절해서 디스플레이 해주는 것입니다.</p>

<p>스크립트를 실행하면 glogin.sql에 HR의 모든 컬럼들이 등록되고 자동으로 종료됩니다.</p>

<div class="warn">

sqlplus /nolog 로 접속할 때는 실행되지 않습니다.<br><br>

위 스크립트는 SPOOL작업을 한 쿼리결과를 단순히 glogin.sql에 APPEND 작업만 한 것입니다. 중복실행에 유의하세요.

</div>

<p>어디까지나 개인 콘솔의 환경설정입니다.</p>

<p>주석을 첨부했으니 자신의 환경에 맞게 바꾸어 사용하시기 바랍니다.</p>

  </div>

</div><!-- end container -->

<script src="/blog/static/js/script.js"></script>
<script src="/blog/static/js/custom.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>

</body>
</html>